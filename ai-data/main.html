<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    #response, #summary, #period-summary {
      white-space: pre-wrap;
      background: #f2f2f2;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h2>ğŸ’¬ ì‹¬ë¦¬ìƒë‹´ ì±—ë´‡ í…ŒìŠ¤íŠ¸</h2>
  <label for="nickname">ë‹‰ë„¤ì„:</label>
  <input id="nickname" type="text" value="ë³´í˜•" />

  <h3>ëŒ€í™”í•˜ê¸°</h3>
  <textarea id="message" placeholder="ìƒë‹´ìë‹˜ì˜ ì´ì•¼ê¸°ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”..."></textarea>
  <button onclick="sendMessage()">ì „ì†¡</button>
  <div id="response"></div>

  <h3>ğŸ“ ê°ì • ë¦¬í¬íŠ¸ ìƒì„±</h3>
  <button onclick="getSummary()">ìš”ì•½ ìš”ì²­</button>
  <div id="summary"></div>

  <h3>ğŸ•’ ê¸°ê°„ë³„ ë¦¬í¬íŠ¸ ìƒì„± (3íšŒ ìƒë‹´ ê¸°ë¡ ê¸°ë°˜)</h3>
  <button onclick="getPeriodReport()">ê¸°ê°„ë³„ ìš”ì•½ ìš”ì²­</button>
  <div id="period-summary"></div>

  <script>
    const API_URL = "https://k12s202.p.ssafy.io/ai-data"; // ì‹¤ì œ ì„œë²„ ì£¼ì†Œë¡œ ë³€ê²½ í•„ìš”

    const localUserContext = {
      botCustom: "ìƒëƒ¥í•œ",
      gender: "FEMALE",
      age: "THIRTIES",
      career: "ë°±ì—”ë“œ ê°œë°œì",
      mbti: "INFJ",
      depression: 10,
      anxiety: 7,
      stress: 12,
      isSuicidal: false,
      stressReason: "í”„ë¡œì íŠ¸ ë§ˆê°"
    };

    const localEmotion = {
      happiness: 20,
      sadness: 50,
      angry: 5,
      neutral: 20,
      other: 5
    };

    const dialogs = [
      // ğŸŸ£ 1íšŒì°¨
      "ìƒë‹´ì: ì•„ë¬´ê²ƒë„ í•˜ê³  ì‹¶ì§€ ì•Šì•„ìš”. ìš”ì¦˜ ê·¸ëƒ¥ ëˆ„ì›Œë§Œ ìˆê³  ì‹¶ì–´ìš”.",
      "AI: ì—ë„ˆì§€ê°€ ë§ì´ ë–¨ì–´ì§„ ìƒíƒœ ê°™ì•„ìš”. ì–´ë–¤ ë•Œ ê°€ì¥ ë¬´ê¸°ë ¥í•˜ê²Œ ëŠê»´ì§€ì…¨ì„ê¹Œìš”?",
      "ìƒë‹´ì: ê·¸ëƒ¥ ì•„ì¹¨ì— ëˆˆëœ¨ëŠ” ê²ƒë„ ê´´ë¡œì›Œìš”.",
      "AI: ê·¸ë§Œí¼ í˜ë“  ì‹œê°„ì´ ê³„ì†ë˜ê³  ìˆì—ˆë˜ ê²ƒ ê°™ì•„ìš”. ìš”ì¦˜ ê°€ì¥ í˜ë“¤ë‹¤ê³  ëŠë¼ëŠ” ìˆœê°„ì€ ì–¸ì œì¸ê°€ìš”?",

      // ğŸ”µ 2íšŒì°¨
      "ìƒë‹´ì: ì–´ì œëŠ” ì˜¤ëœë§Œì— ë°–ì— ë‚˜ê°”ì–´ìš”.",
      "AI: ì˜í•˜ì…¨ì–´ìš”. ì™¸ì¶œì´ ì‰½ì§€ ì•Šì•˜ì„ í…ë° ìš©ê¸° ë‚´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”.",
      "ìƒë‹´ì: ì•„ì§ë„ í˜ë“¤ê¸´ í•œë°, ê³„ì† ì´ë ‡ê²Œ ìˆì–´ì„  ì•ˆ ë˜ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆì–´ìš”.",
      "AI: ê·¸ë ‡ê²Œ ëŠë¼ì‹  ê±´ ì¤‘ìš”í•œ ë³€í™”ì˜ ì‹œì‘ì´ì—ìš”. ìŠ¤ìŠ¤ë¡œë¥¼ ëŒë³´ë ¤ëŠ” ë§ˆìŒì´ ëŠê»´ì ¸ìš”.",

      // ğŸŸ¢ 3íšŒì°¨
      "ìƒë‹´ì: ìš”ì¦˜ì€ ì˜ˆì „ë§Œí¼ í˜ë“¤ì§„ ì•Šì•„ìš”.",
      "AI: ê·¸ë ‡ê²Œ ë§ì”€í•´ì£¼ì…”ì„œ ê¸°ë»ìš”. ìŠ¤ìŠ¤ë¡œë¥¼ ì–´ë–»ê²Œ ëŒë³´ë©° ì§€ë‚´ì…¨ë‚˜ìš”?",
      "ìƒë‹´ì: ì‚°ì±…ì„ ìì£¼ í•˜ê³ , ì˜ˆì „ë³´ë‹¤ ì ë„ ì˜ ììš”.",
      "AI: ì†Œì†Œí•œ ì¼ìƒë“¤ì´ íšŒë³µì˜ ê¸°ë°˜ì´ ë˜ëŠ” ê²ƒ ê°™ì•„ìš”. ì •ë§ ì˜í•˜ê³  ê³„ì„¸ìš”."
    ];

    async function sendMessage() {
      const message = document.getElementById("message").value;
      const nickname = document.getElementById("nickname").value;

      const payload = {
        nickname,
        message,
        isVoice: false,
        userContext: localUserContext,
        emotion: localEmotion
      };

      const res = await fetch(`${API_URL}/chat`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      document.getElementById("response").innerText = "ğŸ§  AI ì‘ë‹µ: " + data.ai_response;
    }

    async function getSummary() {
      const nickname = document.getElementById("nickname").value;
      const res = await fetch(`${API_URL}/summary`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nickname })
      });
      const data = await res.json();
      const result = 
        `ğŸ“‹ ìƒë‹´ ìš”ì•½:\n${data.summary}\n\n` +
        `ğŸ” ê°ì • ë¶„ì„:\n${data.analyze}\n\n` +
        `ğŸ§­ Russell ê°ì • ì¢Œí‘œ:\nValence: ${data.valence}, Arousal: ${data.arousal}`;
      document.getElementById("summary").innerText = result;
    }

async function getPeriodReport() {
  const nickname = document.getElementById("nickname").value;

  try {
    const reportResponse = await fetch(`${API_URL}/period-report`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nickname, dialogs })
    });

    const reportData = await reportResponse.json();

    if (reportData.error) {
      document.getElementById("period-summary").innerText =
        "âš ï¸ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n" + reportData.raw_response;
      return;
    }

    const result =
      `ğŸ“‹ <b>ìƒë‹´ ìš”ì•½</b>\n${reportData.summary}\n\n` +
      `ğŸ‘ <b>AIì˜ ê¸ì •ì  í”¼ë“œë°±</b>\n${reportData.compliment}\n\n` +
      `ğŸ˜Ÿ <b>ìƒë‹´ìê°€ í‘œí˜„í•œ ì‹¬ë¦¬ì  ì–´ë ¤ì›€</b>\n${reportData.worry}\n\n` +
      `ğŸ’¡ <b>AIì˜ ìƒë‹´ì  ê°œì…</b>\n${reportData.advice}`;

    document.getElementById("period-summary").innerHTML = result.replace(/\n/g, "<br>");
  } catch (error) {
    document.getElementById("period-summary").innerText =
      "âŒ ë¦¬í¬íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n" + error;
  }
}


  </script>
</body>
</html>
