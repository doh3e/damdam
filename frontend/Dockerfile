# frontend/Dockerfile
FROM node:22
WORKDIR /app

# 1) 의존성 설치
COPY package*.json ./
RUN npm install

# 2) 빌드 인자(build-time args) 수신
ARG NEXT_PUBLIC_DAMDAM_BASE_URL
ARG NEXT_PUBLIC_WEBSOCKET_URL
ARG NEXT_PUBLIC_GOOGLE_LOGIN_URL
ARG NEXT_PUBLIC_NAVER_LOGIN_URL
ARG NEXT_PUBLIC_KAKAO_LOGIN_URL
ARG OPENAI_API_KEY

# 3) 빌드 환경변수로 설정
ENV NODE_ENV=production
ENV NEXT_PUBLIC_DAMDAM_BASE_URL=${NEXT_PUBLIC_DAMDAM_BASE_URL}
ENV NEXT_PUBLIC_WEBSOCKET_URL=${NEXT_PUBLIC_WEBSOCKET_URL}
ENV NEXT_PUBLIC_GOOGLE_LOGIN_URL=${NEXT_PUBLIC_GOOGLE_LOGIN_URL}
ENV NEXT_PUBLIC_NAVER_LOGIN_URL=${NEXT_PUBLIC_NAVER_LOGIN_URL}
ENV NEXT_PUBLIC_KAKAO_LOGIN_URL=${NEXT_PUBLIC_KAKAO_LOGIN_URL}
ENV OPENAI_API_KEY=${OPENAI_API_KEY}

# 4) 소스 복사 후 빌드
COPY . .



RUN npm run build

# 5) 런타임(서버) 설정
EXPOSE 3000
CMD ["npm", "run", "start"]

